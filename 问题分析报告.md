# æ·±åº¦é—®é¢˜åˆ†ææŠ¥å‘Š

## ğŸ”´ é—®é¢˜ 1ï¼šBilibili æœç´¢å®Œå…¨æ— ç”¨ï¼ˆä»æœªè¢«è°ƒç”¨ï¼‰

### ç°è±¡åˆ†æ

ä»ä½ çš„è¿è¡Œæ—¥å¿—ä¸­ï¼Œæˆ‘å‘ç°ï¼š

```
youtube_search â†’ é‡‡é›† 8 æ¡
youtube_monitor â†’ é‡‡é›† 10 æ¡
ğŸ“Š å½“å‰è¿›åº¦: 18/18 æ¡ âœ… è¾¾æ ‡åœæ­¢
```

**å…³é”®å‘ç°**ï¼š
- âŒ æ²¡æœ‰ä»»ä½• `[Bilibili] Searching for:` æ—¥å¿—
- âŒ Bilibili å·¥å…·æ³¨å†Œäº†ï¼Œä½†ä»æœªè¢«è°ƒç”¨
- âœ… YouTube å·¥å…·æ­£å¸¸å·¥ä½œ

### æ ¹æœ¬åŸå› 

#### åŸå›  1ï¼šPlanner çš„å†³ç­–åå¥½ â­â­â­â­â­

**ä»£ç ä½ç½®**ï¼š`nodes/planner.py` ç¬¬ 108-119 è¡Œ

```python
**å…³é”®ç­–ç•¥**:
1. **æœç´¢ç­–ç•¥ (Time-Aware)**:
   - æ ¼å¼ç¤ºä¾‹: "AI News {current_month}", "Python tutorial {current_year}"

2. **è¯­è¨€ç­–ç•¥**:
   - ä¼˜è´¨å†…å®¹ï¼ˆå°¤å…¶æ˜¯æŠ€æœ¯ç±»ï¼‰å¾€å¾€åœ¨è‹±æ–‡å¹³å°ï¼ˆYouTube, Redditï¼‰ä¸Šã€‚
   - **é‡è¦**: åœ¨è°ƒç”¨ `youtube_search` æˆ– `reddit_search` æ—¶ï¼Œè¯·åŠ¡å¿…å°†ä¸­æ–‡å…³é”®è¯**ç¿»è¯‘æˆè‹±æ–‡**è¿›è¡Œæœç´¢ã€‚
   - å¯¹äº `bilibili_search`ï¼Œè¯·ä¿æŒä½¿ç”¨ä¸­æ–‡ã€‚

3. **å·¥å…·é€‰æ‹©**:
   - å¦‚æœæŸä¸ªå·¥å…·å¤±è´¥äº†ï¼ˆä¾‹å¦‚ YouTube æœä¸åˆ°ï¼‰ï¼Œå°è¯•åˆ‡æ¢åˆ° Reddit æˆ– Web Searchã€‚
   - ä¸è¦æ­»ç£•ä¸€ä¸ªå¹³å°ã€‚
```

**é—®é¢˜åˆ†æ**ï¼š

1. **æç¤ºè¯æš—ç¤º YouTube æ›´å¥½**ï¼š
   - "ä¼˜è´¨å†…å®¹ï¼ˆå°¤å…¶æ˜¯æŠ€æœ¯ç±»ï¼‰å¾€å¾€åœ¨è‹±æ–‡å¹³å°ï¼ˆYouTube, Redditï¼‰ä¸Š"
   - è¿™æš—ç¤º LLM ä¼˜å…ˆé€‰æ‹© YouTube

2. **ç¼ºå°‘å¹³è¡¡ç­–ç•¥**ï¼š
   - æ²¡æœ‰å¼ºåˆ¶"å¿…é¡»å°è¯•æ‰€æœ‰å¹³å°"çš„æŒ‡ä»¤
   - æ²¡æœ‰"æ¯ä¸ªå¹³å°è‡³å°‘é‡‡é›† N æ¡"çš„è¦æ±‚

3. **è¿‡æ—©è¾¾æ ‡åœæ­¢**ï¼š
   - YouTube æœç´¢ 8 æ¡ + ç›‘æ§ 10 æ¡ = 18 æ¡
   - æ­£å¥½è¾¾æ ‡ï¼Œç«‹å³åœæ­¢
   - Planner æ ¹æœ¬æ²¡æœºä¼šè°ƒç”¨ Bilibili

#### åŸå›  2ï¼šHarvest æœºåˆ¶ç«‹å³è§¦å‘ç›‘æ§ â­â­â­â­

**æµç¨‹åˆ†æ**ï¼š

```
youtube_search â†’ 8 æ¡è§†é¢‘
    â†“
Executor: _harvest_sources
    â†“
ä» 8 ä¸ªè§†é¢‘ä¸­æå– 6 ä¸ªé¢‘é“ ID
    â†“
åŠ å…¥ pending_monitors["youtube"]
    â†“
ä¸‹ä¸€è½® Planner:
    æ£€æŸ¥ pending_monitors ä¸ä¸ºç©º
    â†“
æ‰§è¡Œ youtube_monitorï¼ˆä¼˜å…ˆçº§é«˜ï¼‰
    â†“
é‡‡é›† 10 æ¡ï¼Œæ€»è®¡ 18 æ¡ï¼Œè¾¾æ ‡åœæ­¢
```

**é—®é¢˜**ï¼š
- Harvest æœºåˆ¶"ç»‘æ¶"äº† Planner çš„å†³ç­–
- ä¸€æ—¦æœ‰å¾…ç›‘æ§é¢‘é“ï¼ŒPlanner å°±ä¼˜å…ˆç›‘æ§
- æ²¡æœ‰ç»™ Bilibili æœç´¢çš„æœºä¼š

---

## ğŸ”´ é—®é¢˜ 2ï¼šæ‰€æœ‰ç´ æéƒ½è¢«è¿‡æ»¤æ‰ï¼ˆ0 æ¡é€šè¿‡ï¼‰

### ç°è±¡åˆ†æ

```
ç­›é€‰å‰: 18 æ¡ â†’ å»é‡å: 16 æ¡
ç­›é€‰å: 0 æ¡ âœ…
```

**16 æ¡ç´ æå…¨éƒ¨è¢«è¿‡æ»¤ï¼**

### æ ¹æœ¬åŸå› 

#### åŸå›  1ï¼šsource_type ä¸åŒ¹é… â­â­â­â­â­

**ä»£ç ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 28-29 è¡Œ

```python
monitor_items = [i for i in state.candidates if i.source_type == "monitor_kol"]
hunter_items = [i for i in state.candidates if i.source_type in ["keyword_search", "reddit_rss"]]
```

**é—®é¢˜**ï¼š

ä»ä½ çš„æ—¥å¿—çœ‹ï¼š
- `youtube_search` â†’ 8 æ¡
- `youtube_monitor` â†’ 10 æ¡

ä½†çœ‹ä»£ç ï¼š
- **YouTube é€‚é…å™¨**ï¼ˆ`tools/adapters/youtube_adapter.py`ï¼‰æ²¡æœ‰è®¾ç½® `source_type`
- **Executor**ï¼ˆ`nodes/executor.py` ç¬¬ 76 è¡Œï¼‰ä¼šè‡ªåŠ¨è®¾ç½®ï¼š
  ```python
  if "source_type" not in item:
      item["source_type"] = tool_name  # "youtube_search" or "youtube_monitor"
  ```

**å®é™…çš„ source_type**ï¼š
- `youtube_search` â†’ `source_type = "youtube_search"`
- `youtube_monitor` â†’ `source_type = "youtube_monitor"`

**ç­›é€‰å™¨æœŸæœ›çš„ source_type**ï¼š
- ç›‘æ§æ¨¡å¼ï¼š`source_type = "monitor_kol"` âŒ ä¸åŒ¹é…ï¼
- çŒæ€æ¨¡å¼ï¼š`source_type in ["keyword_search", "reddit_rss"]` âŒ ä¸åŒ¹é…ï¼

**ç»“æœ**ï¼š
- æ‰€æœ‰ YouTube æ•°æ®éƒ½ä¸åŒ¹é…ä»»ä½•ç­–ç•¥
- å…¨éƒ¨è¢«è¿‡æ»¤æ‰

---

#### åŸå›  2ï¼šauthor_fans å’Œ author_avg_views ç¼ºå¤± â­â­â­â­

**ä»£ç ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 40-58 è¡Œ

```python
# ç­–ç•¥ A: ç›‘æ§æ¨¡å¼
if item.author_avg_views > 0:
    ratio = item.view_count / item.author_avg_views
    if ratio > 1.2:
        valid_items.append(item)
else:
    # å…œåº•ç­–ç•¥
    if item.view_count > 5000 or item.interaction > 100:
        valid_items.append(item)
```

**é—®é¢˜**ï¼š

æŸ¥çœ‹ **YouTube é€‚é…å™¨**ï¼ˆ`tools/youtube_scout.py`ï¼‰çš„è¾“å‡ºæ ¼å¼ï¼š

```python
# YouTube æ•°æ®æ ¼å¼ï¼ˆæ¨æµ‹ï¼‰
{
    "platform": "youtube",
    "title": "...",
    "url": "...",
    "author_name": "...",
    "author_id": "...",
    "view_count": 1000,
    "interaction": 50,
    # âŒ ç¼ºå°‘ author_fans
    # âŒ ç¼ºå°‘ author_avg_views
}
```

**åæœ**ï¼š
- `author_avg_views = 0`ï¼ˆé»˜è®¤å€¼ï¼‰
- è§¦å‘å…œåº•ç­–ç•¥ï¼š`view_count > 5000 or interaction > 100`
- ä½†å¦‚æœè§†é¢‘æ’­æ”¾é‡ < 5000 ä¸”äº’åŠ¨ < 100ï¼Œç›´æ¥è¢«è¿‡æ»¤

---

#### åŸå›  3ï¼šçŒæ€æ¨¡å¼çš„æ—¶æ•ˆæ£€æŸ¥è¿‡ä¸¥ â­â­â­

**ä»£ç ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 72-73 è¡Œ

```python
# 1. 14å¤©æ—¶æ•ˆæ£€æŸ¥ (æœç´¢ç»“æœæ”¾å®½åˆ°2å‘¨)
if not _check_time(item.publish_time, days=14):
    continue  # è¶…è¿‡ 14 å¤©ï¼Œç›´æ¥è¿‡æ»¤
```

**é—®é¢˜**ï¼š

`youtube_monitor` ç›‘æ§é¢‘é“æ—¶ï¼Œè¿”å›çš„æ˜¯"æœ€è¿‘è§†é¢‘"ï¼Œå¯èƒ½åŒ…æ‹¬ï¼š
- 1 å¤©å‰çš„è§†é¢‘ âœ…
- 7 å¤©å‰çš„è§†é¢‘ âœ…
- 15 å¤©å‰çš„è§†é¢‘ âŒ è¢«è¿‡æ»¤
- 30 å¤©å‰çš„è§†é¢‘ âŒ è¢«è¿‡æ»¤

å¦‚æœé¢‘é“æ›´æ–°ä¸é¢‘ç¹ï¼Œå¤§éƒ¨åˆ†è§†é¢‘å¯èƒ½è¶…è¿‡ 14 å¤©ã€‚

---

#### åŸå›  4ï¼šä¸­ä½æ•°è®¡ç®—é—®é¢˜ â­â­â­

**ä»£ç ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 64-68 è¡Œ

```python
if hunter_items:
    views = [i.view_count for i in hunter_items if i.view_count > 0]
    median_views = statistics.median(views) if views else 1000

    print(f"ğŸ“Š çŒæ€æ± æ’­æ”¾ä¸­ä½æ•°: {median_views}")

    for item in hunter_items:
        # æ ‡å‡†: æ’­æ”¾é‡ > 2å€ä¸­ä½æ•°
        is_view_outlier = (item.view_count > median_views * 2)
```

**é—®é¢˜ç¤ºä¾‹**ï¼š

å‡è®¾ä½ é‡‡é›†äº† 8 ä¸ªè§†é¢‘ï¼Œæ’­æ”¾é‡åˆ†åˆ«æ˜¯ï¼š
```
[500, 800, 1000, 1200, 1500, 2000, 3000, 5000]
ä¸­ä½æ•° = (1200 + 1500) / 2 = 1350
```

**ç­›é€‰æ ‡å‡†**ï¼šæ’­æ”¾é‡ > 1350 * 2 = 2700

**ç»“æœ**ï¼š
- 5000 âœ… é€šè¿‡
- 3000 âœ… é€šè¿‡
- å…¶ä½™ 6 ä¸ª âŒ è¢«è¿‡æ»¤

**å¦‚æœæ‰€æœ‰è§†é¢‘æ’­æ”¾é‡éƒ½å·®ä¸å¤š**ï¼š
```
[1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700]
ä¸­ä½æ•° = 1350
ç­›é€‰æ ‡å‡† = 2700
```
â†’ **å…¨éƒ¨è¢«è¿‡æ»¤ï¼**

---

## ğŸ“Š å®Œæ•´çš„æ•°æ®æµè¿½è¸ª

### ä½ çš„å®é™…è¿è¡Œæƒ…å†µ

```
1. youtube_search é‡‡é›† 8 æ¡
   source_type = "youtube_search"
   â†“
2. è¿›å…¥ Filter
   â†“
3. åˆ†ç»„:
   monitor_items = [] (å› ä¸º source_type != "monitor_kol")
   hunter_items = [] (å› ä¸º source_type != "keyword_search")
   â†“
4. ç­–ç•¥ A: è·³è¿‡ï¼ˆmonitor_items ä¸ºç©ºï¼‰
   ç­–ç•¥ B: è·³è¿‡ï¼ˆhunter_items ä¸ºç©ºï¼‰
   â†“
5. valid_items = [] â†’ 0 æ¡é€šè¿‡

6. youtube_monitor é‡‡é›† 10 æ¡
   source_type = "youtube_monitor"
   â†“
7. è¿›å…¥ Filterï¼ˆå’Œ youtube_search ä¸€èµ·ï¼‰
   â†“
8. å»é‡: 18 â†’ 16 æ¡
   â†“
9. åˆ†ç»„:
   monitor_items = [] (å…¨éƒ¨ä¸åŒ¹é…)
   hunter_items = [] (å…¨éƒ¨ä¸åŒ¹é…)
   â†“
10. 0 æ¡é€šè¿‡ç­›é€‰
```

---

## ğŸ¯ é—®é¢˜æ€»ç»“

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|------|---------|------|
| Bilibili ä»æœªè¢«è°ƒç”¨ | â­â­â­â­â­ | å®Œå…¨æ— ç”¨ |
| source_type ä¸åŒ¹é… | â­â­â­â­â­ | æ‰€æœ‰æ•°æ®è¢«è¿‡æ»¤ |
| ç¼ºå°‘ author_fans/author_avg_views | â­â­â­â­ | æ— æ³•ä½¿ç”¨ç›‘æ§ç­–ç•¥ |
| Harvest æœºåˆ¶"ç»‘æ¶"å†³ç­– | â­â­â­â­ | å¹³å°ä¸å¹³è¡¡ |
| ç­›é€‰é˜ˆå€¼è¿‡ä¸¥ | â­â­â­ | æ­£å¸¸è§†é¢‘è¢«è¿‡æ»¤ |

---

## ğŸ”§ æ ¹æœ¬åŸå› å›¾ç¤º

```
Planner å†³ç­–
    â†“
ä¼˜å…ˆ YouTubeï¼ˆæç¤ºè¯åå¥½ï¼‰
    â†“
youtube_search (8æ¡)
    â†“
Harvest æå–é¢‘é“
    â†“
pending_monitors é˜Ÿåˆ—ä¸ä¸ºç©º
    â†“
Planner è¢«"ç»‘æ¶"
    â†“
youtube_monitor (10æ¡)
    â†“
18æ¡è¾¾æ ‡ï¼Œåœæ­¢
    â†“
âŒ Bilibili ä»æœªè¢«è°ƒç”¨

    â†“ è¿›å…¥ Filter
    â†“
æ£€æŸ¥ source_type
    â†“
"youtube_search" != "monitor_kol" âŒ
"youtube_search" != "keyword_search" âŒ
"youtube_monitor" != "monitor_kol" âŒ
    â†“
monitor_items = []
hunter_items = []
    â†“
ç­–ç•¥ A: è·³è¿‡
ç­–ç•¥ B: è·³è¿‡
    â†“
valid_items = []
    â†“
âŒ 0 æ¡é€šè¿‡ç­›é€‰
```

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### è®¾è®¡ç¼ºé™· 1ï¼šsource_type å‘½åä¸ä¸€è‡´

**æœŸæœ›**ï¼š
- ç›‘æ§ â†’ `monitor_kol`
- æœç´¢ â†’ `keyword_search`

**å®é™…**ï¼š
- YouTube ç›‘æ§ â†’ `youtube_monitor`
- YouTube æœç´¢ â†’ `youtube_search`
- Bilibili ç›‘æ§ â†’ `bilibili_monitor`
- Bilibili æœç´¢ â†’ `bilibili_search`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¿®æ”¹ Executorï¼Œç»Ÿä¸€ source_typeï¼š
   - `youtube_monitor` â†’ `monitor_kol`
   - `youtube_search` â†’ `keyword_search`
   - `bilibili_monitor` â†’ `monitor_kol`
   - `bilibili_search` â†’ `keyword_search`

2. æˆ–è€…ä¿®æ”¹ Filterï¼Œæ¥å—å®é™…çš„ source_typeï¼š
   - ç›‘æ§ï¼š`source_type.endswith("_monitor")`
   - æœç´¢ï¼š`source_type.endswith("_search")`

---

### è®¾è®¡ç¼ºé™· 2ï¼šæ•°æ®å­—æ®µä¸å®Œæ•´

YouTube é€‚é…å™¨æ²¡æœ‰è·å–ï¼š
- `author_fans`ï¼ˆé¢‘é“è®¢é˜…æ•°ï¼‰
- `author_avg_views`ï¼ˆåšä¸»å¹³å‡æ’­æ”¾é‡ï¼‰

è¿™å¯¼è‡´ç›‘æ§ç­–ç•¥çš„å¼‚å¸¸æ£€æµ‹æ— æ³•å·¥ä½œã€‚

---

### è®¾è®¡ç¼ºé™· 3ï¼šå¹³å°ä¸å¹³è¡¡

Planner çš„æç¤ºè¯å¼•å¯¼å®ƒï¼š
- ä¼˜å…ˆä½¿ç”¨ YouTubeï¼ˆ"ä¼˜è´¨å†…å®¹å¾€å¾€åœ¨è‹±æ–‡å¹³å°"ï¼‰
- Harvest æœºåˆ¶è®©å®ƒ"é™·å…¥" YouTube é¢‘é“ç›‘æ§
- æ²¡æœ‰"å¼ºåˆ¶å¹³è¡¡"æœºåˆ¶

---

## âœ… ä¿®å¤ä¼˜å…ˆçº§

1. **ç«‹å³ä¿®å¤**ï¼ˆâ­â­â­â­â­ï¼‰ï¼š
   - ç»Ÿä¸€ source_type å‘½å
   - ä¿®å¤ Filter çš„åˆ†ç»„é€»è¾‘

2. **é‡è¦ä¿®å¤**ï¼ˆâ­â­â­â­ï¼‰ï¼š
   - å¢åŠ  Bilibili æœç´¢çš„è°ƒç”¨æ¦‚ç‡
   - é™ä½ç­›é€‰é˜ˆå€¼

3. **ä¼˜åŒ–æ”¹è¿›**ï¼ˆâ­â­â­ï¼‰ï¼š
   - è¡¥å…… YouTube æ•°æ®å­—æ®µ
   - ä¼˜åŒ– Harvest æœºåˆ¶

---

ä¸‹ä¸€æ­¥æˆ‘å°†æä¾›è¯¦ç»†çš„ä¿®å¤æ–¹æ¡ˆã€‚
