# 人工选题交互功能 - 使用指南

**功能**: Human-in-the-Loop Topic Selection
**版本**: v1.0
**日期**: 2025-11-27

---

## 🎯 功能概述

在 Architect 生成选题和 Analyst 深度分析之间，插入**人工审核环节**，让您掌控最终分析的选题。

### 核心能力

1. **查看 AI 建议**: 展示 AI 生成的所有选题，包含标题、切入点、推荐理由
2. **灵活选择**: 支持单选、多选、全选、跳过
3. **自定义添加**: 可以添加 AI 未发现的选题
4. **配置驱动**: 支持交互模式和自动模式切换

---

## 🚀 快速开始

### 场景 1: 交互模式 (默认)

```bash
python main.py
```

**运行流程**:
```
1. AI 收集内容并生成选题
2. 系统暂停，展示选题列表
3. 您选择感兴趣的选题 (如: 1,3)
4. (可选) 添加自定义选题
5. Analyst 分析选定的选题
```

**示例交互**:
```
======================================================================
🎯 选题审核与选择 (Topic Selection & Review)
💡 提示: 可在 config/settings.yaml 中关闭交互模式
======================================================================

📋 AI 已生成 3 个选题建议:

【选题 1】
  标题: AI绘图技术革命
  切入点: Stable Diffusion vs MidJourney 技术对比
  推荐理由: 高热度话题，观看数据优异，技术深度足够
  来源策略: viral_hit
  支撑数据: 15 条内容
----------------------------------------------------------------------
【选题 2】
  标题: AI 视频生成最新突破
  切入点: Sora vs Pika 生成质量对比
  推荐理由: 新兴热点，用户关注度高
  来源策略: tech_news
  支撑数据: 12 条内容
----------------------------------------------------------------------
【选题 3】
  标题: Prompt Engineering 实战技巧
  切入点: 从新手到高手的提示词优化
  推荐理由: 实用性强，教学价值高
  来源策略: competitor
  支撑数据: 18 条内容
----------------------------------------------------------------------

💡 请选择您感兴趣的选题 (支持多选):
  输入格式:
    - 单个: 1
    - 多个: 1,3,5
    - 全选: all 或 *
    - 跳过: 直接回车 (不选任何AI建议)

请输入选择 (默认全选): 1,2

  ✓ 已选择: AI绘图技术革命
  ✓ 已选择: AI 视频生成最新突破

📝 是否添加自定义选题?
  (输入 'y' 添加，直接回车跳过)
添加自定义选题? (y/N): y

✏️ 开始添加自定义选题 (输入空白标题结束):

--- 自定义选题 #1 ---
标题 (必填, 回车结束): AI 语音克隆技术
切入点 (可选): 从 ElevenLabs 到开源方案
选题理由 (可选): 用户在评论区多次提到
✅ 已添加自定义选题: AI 语音克隆技术

--- 自定义选题 #2 ---
标题 (必填, 回车结束): [直接回车结束]

✅ 共添加 1 个自定义选题

✅ 最终选定 3 个选题:
  [1] AI绘图技术革命
  [2] AI 视频生成最新突破
  [3] AI 语音克隆技术
```

---

### 场景 2: 自动模式 (批处理)

适合无人值守运行、定时任务等场景。

**配置** (`config/settings.yaml`):
```yaml
interaction:
  enable_topic_selection: false  # 关闭交互
  auto_select_top_n: 3           # 自动选择 Top 3
  allow_custom_topics: false     # 不允许自定义
```

**运行**:
```bash
python main.py
```

**效果**:
```
⚡ 配置为自动模式，将自动选择 Top 3 个选题
✅ 已自动选择 3 个选题:
  [1] AI绘图技术革命
  [2] AI 视频生成最新突破
  [3] Prompt Engineering 实战技巧
```

---

## ⚙️ 配置详解

### 配置文件位置
`config/settings.yaml`

### 配置选项

```yaml
interaction:
  # 🔑 主开关: 是否启用人工选题
  enable_topic_selection: true
    # true:  启用交互模式，等待用户选择
    # false: 自动模式，无需人工干预

  # 🔢 自动选择数量 (仅 enable_topic_selection=false 时生效)
  auto_select_top_n: 3
    # 自动选择前 N 个选题
    # 如果 AI 生成少于 N 个，则全选

  # ➕ 是否允许添加自定义选题
  allow_custom_topics: true
    # true:  交互模式下询问是否添加自定义
    # false: 只能从 AI 建议中选择
```

---

## 📋 使用场景

### 场景对比

| 场景 | enable_topic_selection | allow_custom_topics | auto_select_top_n | 适用情况 |
|------|------------------------|---------------------|-------------------|----------|
| **日常创作** | ✅ true | ✅ true | - | 需要精准控制选题方向 |
| **快速验证** | ✅ true | ❌ false | - | 只从 AI 建议中选，快速决策 |
| **批量生产** | ❌ false | ❌ false | 5 | 定时任务，自动运行 |
| **灵感补充** | ✅ true | ✅ true | - | AI 建议 + 自己的想法 |

---

## 🎨 交互操作指南

### 1. 选择 AI 建议

**输入格式**:

| 输入 | 含义 | 示例 |
|------|------|------|
| `1` | 选择第 1 个 | 选择: AI绘图技术革命 |
| `1,3,5` | 选择多个 (逗号分隔) | 选择: 选题1, 选题3, 选题5 |
| `all` 或 `*` | 全选 | 所有选题都要 |
| `直接回车` | 全选 (默认) | 所有选题都要 |
| `none` 或 `0` | 跳过 AI 建议 | 只用自定义选题 |

**输入容错**:
- 自动忽略无效选项 (如: 选择 `1,10` 但只有 3 个选题，只选择 1)
- 格式错误自动降级为全选

---

### 2. 添加自定义选题

**流程**:
```
是否添加自定义选题? (y/N): y

--- 自定义选题 #1 ---
标题 (必填, 回车结束): <输入标题>
切入点 (可选): <输入切入点或回车跳过>
选题理由 (可选): <输入理由或回车跳过>

--- 自定义选题 #2 ---
标题 (必填, 回车结束): <直接回车结束>
```

**字段说明**:
- **标题** (必填): 选题的核心主题
- **切入点** (可选): 独特的角度或对比点
- **选题理由** (可选): 为什么做这个选题

**最佳实践**:
```
✅ 好的自定义选题:
标题: AI 语音克隆伦理问题
切入点: 技术进步 vs 隐私风险
选题理由: 最近新闻热点，社会关注度高

❌ 不推荐:
标题: AI
切入点: (空)
选题理由: (空)
→ 太宽泛，Analyst 难以找到精准资料
```

---

## 🔍 后续处理

### 选定选题的命运

```
选定的选题 → Analyst Agent → 深度分析报告
```

**Analyst 会做什么**:
1. **Level 1 Scout**: 根据选题类型规划搜索策略
   - 技术类 → Arxiv 论文
   - 商业类 → 研报和财报
   - 社会类 → 书籍和访谈

2. **Level 2 Excavator**: 执行搜索，提取关键信息
   - 搜索相关资料
   - 提取原文引用
   - 识别冲突观点

3. **Level 3 Philosopher**: 深度分析
   - 第一性原理推导
   - 生成反直觉洞察
   - 输出内容策略

**查看结果**:
```
[深度分析报告] (Deep Analysis Reports)

🔬 分析报告 #1
选题: AI绘图技术革命

底层逻辑 (Root Cause):
扩散模型取代 GAN 的本质是训练稳定性...

主流观点 (Mainstream View):
大众认为 AI 绘图会替代插画师...

反直觉洞察 (Contrarian View):
实际上 AI 降低了创意表达门槛，扩容市场...

置信度: 0.85
```

---

## 🐛 故障排除

### 问题 1: 按回车后没反应

**原因**: IDE 终端编码问题或 EOF 异常

**解决**:
```python
# 系统会自动捕获 EOFError，使用默认值
# 如: 选择时回车 → 自动全选
# 如: 添加自定义时回车 → 自动跳过
```

**验证**:
```bash
# 测试标准输入
echo "1,2" | python main.py
```

---

### 问题 2: 想跳过交互但改配置麻烦

**临时解决**:

方法 1: 一路回车 (默认全选)
```
请输入选择: [直接回车]  → 全选
添加自定义? [直接回车]   → 跳过
```

方法 2: 修改配置
```bash
# 编辑 config/settings.yaml
interaction:
  enable_topic_selection: false
```

---

### 问题 3: AI 没生成任何选题怎么办?

**情况**: 内容收集失败或筛选过于严格

**系统行为**:
```
⚠️ AI 未生成任何选题，您可以手动添加选题。

请手动添加选题:
--- 选题 #1 ---
标题: <必须输入至少一个>
```

**建议**:
- 检查网络和 API Key
- 放宽筛选条件 (config/settings.yaml → thresholds)
- 手动添加选题继续流程

---

## 💡 高级技巧

### 技巧 1: 批量模式与交互模式混用

**需求**: 工作日自动运行，周末人工审核

**方案**: 维护两个配置文件
```bash
# 工作日 (自动)
cp config/settings_auto.yaml config/settings.yaml
python main.py

# 周末 (交互)
cp config/settings_interactive.yaml config/settings.yaml
python main.py
```

**settings_auto.yaml**:
```yaml
interaction:
  enable_topic_selection: false
  auto_select_top_n: 5
```

**settings_interactive.yaml**:
```yaml
interaction:
  enable_topic_selection: true
  allow_custom_topics: true
```

---

### 技巧 2: 预设选题列表

**需求**: 有明确的选题计划，但想用系统分析

**方案**: 跳过 AI 建议，只用自定义

**操作**:
```
请输入选择: none  ← 跳过 AI 建议

添加自定义选题? y

--- 自定义选题 #1 ---
标题: RAG vs Long Context
切入点: 技术选型对比
...

--- 自定义选题 #2 ---
标题: AI Agent 架构设计
切入点: ReAct vs Function Calling
...
```

**效果**: 完全自主控制选题，利用 Analyst 深度分析能力

---

### 技巧 3: 快速测试单个选题

**需求**: 只想测试一个选题的分析效果

**方案**:
```
请输入选择: 1  ← 只选第一个

添加自定义? n  ← 不添加
```

**结果**: 只有 1 个选题进入 Analyst，节省时间和成本

---

## 📊 工作流程图

### 完整流程

```
Keyword Designer
    ↓
Planner (搜索规划)
    ↓
Influencer Extractor (博主提取)
    ↓
Executor (内容收集)
    ↓
Filter (质量筛选)
    ↓
Architect (生成选题)
    ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    ↓
🎯 Topic Selector (人工审核)  ← 您在这里
    ↓
    ├─ 交互模式 (enable=true)
    │   ├─ 展示 AI 选题
    │   ├─ 用户选择 (1,3,5)
    │   └─ 可选添加自定义
    │
    └─ 自动模式 (enable=false)
        └─ 自动选择 Top N
    ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    ↓
Analyst (深度分析)
    ↓
输出 DeepAnalysisReport
```

---

## 📈 数据流示例

### 输入 (来自 Architect)

```python
state.proposals = [
    {
        "id": "topic_001",
        "title": "AI绘图技术革命",
        "core_angle": "Stable Diffusion vs MidJourney",
        "rationale": "高热度，技术深度足够",
        "source_type": "viral_hit",
        "reference_data": [...]
    },
    {
        "id": "topic_002",
        "title": "AI 视频生成突破",
        ...
    }
]
```

### 用户操作

```
选择: 1,2
添加自定义: AI 语音克隆技术
```

### 输出 (给 Analyst)

```python
state.proposals = [
    {
        "id": "topic_001",
        "title": "AI绘图技术革命",
        ...
    },
    {
        "id": "topic_002",
        "title": "AI 视频生成突破",
        ...
    },
    {
        "id": "custom_a3f2d1c8",
        "title": "AI 语音克隆技术",
        "core_angle": "用户自定义选题: AI 语音克隆技术",
        "rationale": "用户手动添加的选题",
        "source_type": "user_custom",
        "reference_data": [...]
    }
]
```

---

## ✅ 最佳实践

### 1. 选题数量控制

**推荐**: 3-5 个选题
- ✅ **3个**: 精品路线，深度分析每个选题
- ✅ **5个**: 批量生产，覆盖多个角度
- ⚠️ **10+**: 分析时间长，成本高，质量可能下降

### 2. 自定义选题质量

**好的自定义选题**:
- ✅ 明确的主题: "AI 语音克隆技术"
- ✅ 清晰的角度: "商业应用 vs 伦理风险"
- ✅ 有背景: "最近新闻热点"

**避免**:
- ❌ 太宽泛: "AI" (Analyst 不知道找什么)
- ❌ 太窄: "GPT-4 的第 37 个参数" (资料稀缺)
- ❌ 过时: "2020 年的技术" (缺乏新鲜感)

### 3. 与 AI 建议结合

**策略**: AI 建议 (数据驱动) + 自定义 (创意补充)

**示例**:
```
AI 建议:
  1. AI绘图技术 (热度高)
  2. Prompt Engineering (数据多)

自定义补充:
  3. AI 音乐生成 (新兴领域，AI 可能未覆盖)
  4. AI 伦理问题 (社会价值，AI 倾向技术选题)
```

**效果**: 数据 + 创意 = 更丰富的内容矩阵

---

## 🔄 迭代建议

### 当前版本 (v1.0)

- ✅ 基础交互选择
- ✅ 自定义选题添加
- ✅ 配置驱动模式切换

### 未来增强 (可选)

- [ ] **选题评分**: 给 AI 建议打分 (1-5 星)，记录偏好
- [ ] **历史记录**: 保存选题历史，避免重复
- [ ] **批量导入**: 从 CSV/JSON 导入选题列表
- [ ] **可视化界面**: Web UI 替代命令行交互
- [ ] **协作模式**: 多人投票选择选题

---

## 📞 常见问题

### Q1: 可以完全跳过 Architect 直接添加选题吗?

**A**: 可以通过配置实现:

```yaml
# 1. 关闭内容收集
target_domains: []

# 2. 启用交互，允许自定义
interaction:
  enable_topic_selection: true
  allow_custom_topics: true
```

运行后，AI 无内容可分析，会提示"未生成选题"，然后您手动添加。

---

### Q2: 自定义选题会影响 Analyst 分析质量吗?

**A**: 不会。Analyst 的 Scout 会根据选题**内容**决定搜索策略，不依赖 `source_type`。

**示例**:
- 自定义: "Stable Diffusion 技术原理"
- Scout 判断: 技术类 → 搜索 Arxiv 论文
- 分析质量: 与 AI 建议相同

**关键**: 选题标题要清晰，Analyst 才能正确分类。

---

### Q3: 可以保存选题以便下次使用吗?

**A**: 当前版本不支持持久化。临时方案:

**导出选题**:
```python
# 在 main.py 末尾添加
import json
with open("selected_topics.json", "w") as f:
    json.dump(final_state["proposals"], f, indent=2, ensure_ascii=False)
```

**下次导入** (需手动实现):
读取 JSON → 转为 TopicBrief → 跳过 Architect

---

## 🎉 总结

**核心价值**:
1. ✅ **掌控权**: 您决定分析哪些选题，不浪费资源
2. ✅ **灵活性**: 交互 vs 自动，满足不同场景
3. ✅ **创意融合**: AI 数据驱动 + 人类创意

**使用建议**:
- 日常: 开启交互，精挑细选
- 批处理: 关闭交互，自动运行
- 灵感爆发: 跳过 AI 建议，全用自定义

**下一步**:
→ 运行 `python main.py`，体验人工选题！
→ 查看 `Analyst智能体-实施完成报告.md` 了解深度分析
