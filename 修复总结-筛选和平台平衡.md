# ä¿®å¤æ€»ç»“ï¼šç­›é€‰å™¨å’Œå¹³å°å¹³è¡¡é—®é¢˜

## ğŸ¯ ä¿®å¤çš„æ ¸å¿ƒé—®é¢˜

### é—®é¢˜ 1ï¼šæ‰€æœ‰ç´ æè¢«è¿‡æ»¤ï¼ˆ0 æ¡é€šè¿‡ï¼‰â­â­â­â­â­

**æ ¹æœ¬åŸå› **ï¼š`source_type` ä¸åŒ¹é…

**ä¿®å¤ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 27-36 è¡Œ

#### ä¿®å¤å‰
```python
monitor_items = [i for i in state.candidates if i.source_type == "monitor_kol"]
hunter_items = [i for i in state.candidates if i.source_type in ["keyword_search", "reddit_rss"]]
```

**é—®é¢˜**ï¼š
- å®é™…çš„ `source_type` æ˜¯ï¼š`youtube_search`, `youtube_monitor`, `bilibili_search`, `bilibili_monitor`
- æœŸæœ›çš„ `source_type` æ˜¯ï¼š`monitor_kol`, `keyword_search`
- **å®Œå…¨ä¸åŒ¹é…** â†’ æ‰€æœ‰æ•°æ®åˆ†ä¸åˆ°ä»»ä½•ç­–ç•¥ â†’ å…¨éƒ¨è¢«è¿‡æ»¤

#### ä¿®å¤å
```python
# ç›‘æ§ç±»ï¼šåŒ…æ‹¬æ‰€æœ‰ *_monitor å·¥å…·
monitor_items = [i for i in state.candidates if
                 i.source_type in ["monitor_kol", "youtube_monitor", "bilibili_monitor"]]
# æœç´¢ç±»ï¼šåŒ…æ‹¬æ‰€æœ‰ *_search å·¥å…·
hunter_items = [i for i in state.candidates if
                i.source_type in ["keyword_search", "reddit_rss", "youtube_search",
                                 "bilibili_search", "web_search"]]

print(f"ğŸ“Š æ•°æ®åˆ†ç±»: ç›‘æ§æ•°æ® {len(monitor_items)} æ¡, æœç´¢æ•°æ® {len(hunter_items)} æ¡")
```

**æ•ˆæœ**ï¼š
- âœ… YouTube/Bilibili æ•°æ®èƒ½æ­£ç¡®åˆ†ç±»
- âœ… å¢åŠ è°ƒè¯•æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°åˆ†ç±»æƒ…å†µ

---

### é—®é¢˜ 2ï¼šç­›é€‰é˜ˆå€¼è¿‡ä¸¥ â­â­â­â­

#### ä¿®å¤ç‚¹ Aï¼šç›‘æ§æ¨¡å¼å…œåº•ç­–ç•¥

**ä¿®å¤ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 62-66 è¡Œ

**ä¿®å¤å‰**ï¼š
```python
if item.view_count > 5000 or item.interaction > 100:
    valid_items.append(item)
```

**é—®é¢˜**ï¼š
- æ’­æ”¾é‡ < 5000 ä¸”äº’åŠ¨ < 100 â†’ ç›´æ¥è¢«è¿‡æ»¤
- å¯¹äºå°è§†é¢‘å¤ªä¸¥æ ¼

**ä¿®å¤å**ï¼š
```python
# ä» 5000 é™åˆ° 1000ï¼Œä» 100 é™åˆ° 50
if item.view_count > 1000 or item.interaction > 50:
    item.score = 70.0
    item.raw_data["analysis_note"] = "ç›‘æ§æ•°æ®ï¼ˆæ— å†å²åŸºå‡†ï¼‰"
    valid_items.append(item)
```

---

#### ä¿®å¤ç‚¹ Bï¼šçŒæ€æ¨¡å¼æ—¶æ•ˆæ£€æŸ¥

**ä¿®å¤ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 79-80 è¡Œ

**ä¿®å¤å‰**ï¼š
```python
if not _check_time(item.publish_time, days=14):
    continue  # è¶…è¿‡ 14 å¤©ï¼Œç›´æ¥è¿‡æ»¤
```

**é—®é¢˜**ï¼š
- `youtube_monitor` è¿”å›çš„"æœ€è¿‘è§†é¢‘"å¯èƒ½åŒ…æ‹¬ 15-30 å¤©å‰çš„
- 14 å¤©æ—¶æ•ˆå¤ªçŸ­ï¼Œå¤§éƒ¨åˆ†è¢«è¿‡æ»¤

**ä¿®å¤å**ï¼š
```python
# ä» 14 å¤©å»¶é•¿åˆ° 30 å¤©
if not _check_time(item.publish_time, days=30):
    continue
```

---

#### ä¿®å¤ç‚¹ Cï¼šçŒæ€æ¨¡å¼ç­›é€‰æ ‡å‡†

**ä¿®å¤ä½ç½®**ï¼š`nodes/filter.py` ç¬¬ 93-94 è¡Œ

**ä¿®å¤å‰**ï¼š
```python
is_view_outlier = (item.view_count > median_views * 2)  # 2å€ä¸­ä½æ•°
is_eng_outlier = (rate > 0.02)  # äº’åŠ¨ç‡ > 2%
```

**é—®é¢˜**ï¼š
- å¦‚æœè§†é¢‘æ’­æ”¾é‡éƒ½å·®ä¸å¤šï¼Œæ²¡æœ‰äººèƒ½è¶…è¿‡ 2 å€ä¸­ä½æ•°
- å…¨éƒ¨è¢«è¿‡æ»¤

**ä¿®å¤å**ï¼š
```python
is_view_outlier = (item.view_count > median_views * 1.5)  # é™åˆ° 1.5å€
is_eng_outlier = (rate > 0.01)  # é™åˆ° 1%
```

**æ•ˆæœ**ï¼š
- âœ… ç­›é€‰æ ‡å‡†æ›´å®½æ¾
- âœ… æ›´å¤šè§†é¢‘èƒ½é€šè¿‡

---

### é—®é¢˜ 3ï¼šBilibili å®Œå…¨ä¸è¢«è°ƒç”¨ â­â­â­â­â­

**æ ¹æœ¬åŸå› **ï¼šHarvest æœºåˆ¶"ç»‘æ¶"å†³ç­– + æç¤ºè¯åå¥½ YouTube

#### ä¿®å¤ç‚¹ Aï¼šè°ƒæ•´ Planner æç¤ºè¯

**ä¿®å¤ä½ç½®**ï¼š`nodes/planner.py` ç¬¬ 115-128 è¡Œ

**ä¿®å¤å‰**ï¼š
```python
2. **è¯­è¨€ç­–ç•¥**:
   - ä¼˜è´¨å†…å®¹ï¼ˆå°¤å…¶æ˜¯æŠ€æœ¯ç±»ï¼‰å¾€å¾€åœ¨è‹±æ–‡å¹³å°ï¼ˆYouTube, Redditï¼‰ä¸Šã€‚
   - å¯¹äº `bilibili_search`ï¼Œè¯·ä¿æŒä½¿ç”¨ä¸­æ–‡ã€‚

3. **å·¥å…·é€‰æ‹©**:
   - å¦‚æœæŸä¸ªå·¥å…·å¤±è´¥äº†ï¼Œå°è¯•åˆ‡æ¢åˆ°å…¶ä»–å¹³å°
```

**é—®é¢˜**ï¼š
- "ä¼˜è´¨å†…å®¹å¾€å¾€åœ¨è‹±æ–‡å¹³å°" â†’ LLM åå¥½ YouTube
- æ²¡æœ‰"å¿…é¡»å°è¯•æ‰€æœ‰å¹³å°"çš„å¼ºåˆ¶è¦æ±‚

**ä¿®å¤å**ï¼š
```python
2. **è¯­è¨€ç­–ç•¥**:
   - ä½ çš„ç›®æ ‡å—ä¼—æ˜¯ä¸­æ–‡ç”¨æˆ·ï¼Œéœ€è¦åŒæ—¶è¦†ç›–ä¸­è‹±æ–‡å¹³å°ã€‚
   - **YouTube/Reddit**: ä½¿ç”¨è‹±æ–‡å…³é”®è¯æœç´¢
   - **Bilibili**: ä½¿ç”¨ä¸­æ–‡å…³é”®è¯æœç´¢

3. **å¹³å°å¹³è¡¡ç­–ç•¥** â­ éå¸¸é‡è¦ï¼š
   - **å¿…é¡»åŒæ—¶å°è¯• YouTube å’Œ Bilibili ä¸¤ä¸ªå¹³å°**ï¼Œä¸è¦åªä¾èµ–ä¸€ä¸ª
   - ä¼˜å…ˆé¡ºåºï¼šå…ˆæ‰§è¡Œå¹¿æ³›æœç´¢ï¼ˆyoutube_search, bilibili_searchï¼‰ï¼Œå†è€ƒè™‘ç›‘æ§
   - å¦‚æœå·²ç»æ‰§è¡Œäº† youtube_searchï¼Œä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œ bilibili_search ä»¥ä¿æŒå¹³è¡¡
   - ä¸è¦è®© pending_monitors é˜Ÿåˆ—"ç»‘æ¶"ä½ çš„å†³ç­–ï¼Œå…ˆå®Œæˆå¹³å°è¦†ç›–
```

---

#### ä¿®å¤ç‚¹ Bï¼šé˜»æ­¢ Harvest è¿‡æ—©è§¦å‘ç›‘æ§

**ä¿®å¤ä½ç½®**ï¼š`nodes/planner.py` ç¬¬ 194-211 è¡Œ

**ä¿®å¤å‰**ï¼š
```python
def _deterministic_plan(state, today, year, month):
    # ç›´æ¥æ£€æŸ¥ pending_monitorsï¼Œæœ‰å°±æ‰§è¡Œ
    action = _schedule_pending_monitor(state)
    if action:
        return action
    return None
```

**é—®é¢˜æµç¨‹**ï¼š
```
youtube_search (8æ¡)
    â†“
Harvest æå– 6 ä¸ªé¢‘é“
    â†“
pending_monitors = [é¢‘é“1, é¢‘é“2, ...]
    â†“
ä¸‹ä¸€è½® Planner:
    _deterministic_plan è¿”å› youtube_monitor
    â†“
æ‰§è¡Œç›‘æ§ (10æ¡)
    â†“
18æ¡è¾¾æ ‡ï¼Œåœæ­¢
    â†“
âŒ Bilibili ä»æœªè¢«è°ƒç”¨
```

**ä¿®å¤å**ï¼š
```python
def _deterministic_plan(state, today, year, month):
    # ğŸ”‘ å…³é”®ä¿®å¤ï¼šåªåœ¨æœç´¢é˜¶æ®µå®Œæˆåæ‰æ‰§è¡Œç›‘æ§
    youtube_searched = state.platform_search_progress.get("youtube", False)
    bilibili_searched = state.platform_search_progress.get("bilibili", False)

    # å¦‚æœè¿˜æ²¡æœ‰å®Œæˆå¹³å°æœç´¢ï¼Œä¸æ‰§è¡Œç›‘æ§ï¼ˆé¿å…è¢«"ç»‘æ¶"ï¼‰
    if not (youtube_searched and bilibili_searched):
        return None

    # ä¸¤ä¸ªå¹³å°éƒ½æœç´¢å®Œäº†ï¼Œæ‰æ‰§è¡Œç›‘æ§
    action = _schedule_pending_monitor(state)
    if action:
        return action
    return None
```

**ä¿®å¤åçš„æµç¨‹**ï¼š
```
youtube_search (8æ¡)
    â†“
æ ‡è®° platform_search_progress["youtube"] = True
    â†“
Harvest æå– 6 ä¸ªé¢‘é“ â†’ pending_monitors
    â†“
ä¸‹ä¸€è½® Planner:
    _deterministic_plan æ£€æŸ¥ï¼š
        youtube_searched = True
        bilibili_searched = False âŒ
        è¿”å› Noneï¼ˆä¸æ‰§è¡Œç›‘æ§ï¼‰
    â†“
LLM è§„åˆ’ï¼šåº”è¯¥æ‰§è¡Œ bilibili_search
    â†“
bilibili_search (8æ¡)
    â†“
æ ‡è®° platform_search_progress["bilibili"] = True
    â†“
ä¸‹ä¸€è½® Planner:
    _deterministic_plan æ£€æŸ¥ï¼š
        youtube_searched = True
        bilibili_searched = True âœ…
        ç°åœ¨å¯ä»¥æ‰§è¡Œç›‘æ§äº†
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰

```
youtube_search â†’ 8 æ¡
    â†“
youtube_monitor â†’ 10 æ¡ï¼ˆè¢« Harvest "ç»‘æ¶"ï¼‰
    â†“
18 æ¡è¾¾æ ‡ï¼Œåœæ­¢
    â†“
âŒ Bilibili ä»æœªè¢«è°ƒç”¨

è¿›å…¥ Filter:
    monitor_items = []  (source_type ä¸åŒ¹é…)
    hunter_items = []   (source_type ä¸åŒ¹é…)
    â†“
    ç­–ç•¥ A: è·³è¿‡
    ç­–ç•¥ B: è·³è¿‡
    â†“
    0 æ¡é€šè¿‡ç­›é€‰ âŒ
```

### ä¿®å¤å

```
youtube_search â†’ 8 æ¡
ğŸ“Š æ ‡è®° YouTube æœç´¢å®Œæˆ
    â†“
Planner: æ£€æŸ¥åˆ° Bilibili æœªæœç´¢
    â†“
bilibili_search â†’ 8 æ¡
ğŸ“Š æ ‡è®° Bilibili æœç´¢å®Œæˆ
    â†“
Planner: ä¸¤ä¸ªå¹³å°éƒ½æœç´¢å®Œï¼Œå¯ä»¥ç›‘æ§
    â†“
youtube_monitor â†’ è‹¥å¹²æ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰
    â†“
è¾¾åˆ°ç›®æ ‡ï¼Œåœæ­¢

è¿›å…¥ Filter:
    ğŸ“Š æ•°æ®åˆ†ç±»: ç›‘æ§æ•°æ® X æ¡, æœç´¢æ•°æ® Y æ¡
    â†“
    ç­–ç•¥ A: å¤„ç†ç›‘æ§æ•°æ®ï¼ˆæ­£ç¡®åˆ†ç±»ï¼‰
    ç­–ç•¥ B: å¤„ç†æœç´¢æ•°æ®ï¼ˆæ­£ç¡®åˆ†ç±»ï¼‰
    â†“
    é€šè¿‡ç­›é€‰: 5-10 æ¡ âœ…
```

---

## ğŸ¯ å…³é”®ä¿®å¤æ€»ç»“

| é—®é¢˜ | ä¿®å¤ | æ–‡ä»¶ | è¡Œå· |
|------|------|------|------|
| source_type ä¸åŒ¹é… | æ‰©å±•åŒ¹é…åˆ—è¡¨ | `nodes/filter.py` | 27-36 |
| ç›‘æ§å…œåº•é˜ˆå€¼è¿‡é«˜ | 5000â†’1000, 100â†’50 | `nodes/filter.py` | 62-66 |
| æ—¶æ•ˆæ£€æŸ¥è¿‡ä¸¥ | 14å¤©â†’30å¤© | `nodes/filter.py` | 79-80 |
| çŒæ€æ ‡å‡†è¿‡ä¸¥ | 2å€â†’1.5å€, 2%â†’1% | `nodes/filter.py` | 93-94 |
| æç¤ºè¯åå¥½ YouTube | å¼ºè°ƒå¹³å°å¹³è¡¡ | `nodes/planner.py` | 115-128 |
| Harvest ç»‘æ¶å†³ç­– | æœç´¢å®Œæˆåå†ç›‘æ§ | `nodes/planner.py` | 194-211 |

---

## ğŸ§ª é¢„æœŸæµ‹è¯•ç»“æœ

### æµ‹è¯• 1ï¼šBilibili åº”è¯¥è¢«è°ƒç”¨

è¿è¡Œç¨‹åºåï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
youtube_search â†’ 8 æ¡
ğŸ“Š æ ‡è®° YouTube æœç´¢å®Œæˆ

bilibili_search â†’ X æ¡  âœ… Bilibili è¢«è°ƒç”¨äº†ï¼
ğŸ“Š æ ‡è®° Bilibili æœç´¢å®Œæˆ
```

### æµ‹è¯• 2ï¼šç­›é€‰åº”è¯¥æœ‰æ•°æ®é€šè¿‡

```
è¿›å…¥ Filter:
ğŸ“Š æ•°æ®åˆ†ç±»: ç›‘æ§æ•°æ® X æ¡, æœç´¢æ•°æ® Y æ¡  âœ… èƒ½æ­£ç¡®åˆ†ç±»

ğŸ§¹ æ™ºèƒ½ç­›é€‰å®Œæˆ: ä» Z æ¡ä¸­ç²¾é€‰ 5-10 æ¡  âœ… æœ‰æ•°æ®é€šè¿‡
```

### æµ‹è¯• 3ï¼šæœ€ç»ˆæœ‰é€‰é¢˜è¾“å‡º

```
[ç²¾é€‰é€‰é¢˜ç®€æŠ¥]

ğŸ“„ é€‰é¢˜ #1
æ ‡é¢˜: ...  âœ… æœ‰é€‰é¢˜ç”Ÿæˆ
```

---

## ğŸ’¡ è®¾è®¡æ”¹è¿›å»ºè®®

### çŸ­æœŸå»ºè®®

1. **å¢åŠ è°ƒè¯•æ—¥å¿—**ï¼š
   - âœ… å·²æ·»åŠ ï¼š`ğŸ“Š æ•°æ®åˆ†ç±»`
   - å»ºè®®æ·»åŠ ï¼šæ¯ä¸ªè§†é¢‘çš„ `source_type` å’Œ `score`

2. **åŠ¨æ€è°ƒæ•´é˜ˆå€¼**ï¼š
   - æ ¹æ®å®é™…æ•°æ®åˆ†å¸ƒè°ƒæ•´ç­›é€‰æ ‡å‡†
   - å¦‚æœç­›é€‰å < 3 æ¡ï¼Œè‡ªåŠ¨é™ä½é˜ˆå€¼

### é•¿æœŸå»ºè®®

1. **ç»Ÿä¸€ source_type å‘½å**ï¼š
   ```python
   # åœ¨ Executor ä¸­ç»Ÿä¸€è½¬æ¢
   mapping = {
       "youtube_monitor": "monitor_kol",
       "bilibili_monitor": "monitor_kol",
       "youtube_search": "keyword_search",
       "bilibili_search": "keyword_search"
   }
   ```

2. **è¡¥å…… YouTube æ•°æ®å­—æ®µ**ï¼š
   - å¢åŠ  `author_fans`ï¼ˆé¢‘é“è®¢é˜…æ•°ï¼‰
   - å¢åŠ  `author_avg_views`ï¼ˆåšä¸»å¹³å‡æ’­æ”¾é‡ï¼‰
   - è¿™æ ·ç›‘æ§ç­–ç•¥çš„å¼‚å¸¸æ£€æµ‹æ‰èƒ½å·¥ä½œ

3. **æ™ºèƒ½å¹³å°åˆ†é…**ï¼š
   - æ ¹æ®ä¸»é¢˜è‡ªåŠ¨é€‰æ‹©å¹³å°
   - æŠ€æœ¯ç±» â†’ YouTube ä¼˜å…ˆ
   - ä¸­æ–‡å†…å®¹ â†’ Bilibili ä¼˜å…ˆ

---

## âœ… æ€»ç»“

è¿™æ¬¡ä¿®å¤è§£å†³äº†ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

1. **ç­›é€‰å™¨å¤±æ•ˆ**ï¼ˆsource_type ä¸åŒ¹é…ï¼‰
   - ä¿®å¤ï¼šæ‰©å±•åŒ¹é…åˆ—è¡¨ï¼Œæ”¯æŒå®é™…çš„ source_type
   - ä¿®å¤ï¼šé™ä½é˜ˆå€¼ï¼Œè®©æ›´å¤šå†…å®¹é€šè¿‡

2. **å¹³å°ä¸å¹³è¡¡**ï¼ˆBilibili ä¸è¢«è°ƒç”¨ï¼‰
   - ä¿®å¤ï¼šè°ƒæ•´æç¤ºè¯ï¼Œå¼ºè°ƒå¹³å°å¹³è¡¡
   - ä¿®å¤ï¼šé˜»æ­¢ Harvest è¿‡æ—©è§¦å‘ç›‘æ§

**å…³é”®æ´å¯Ÿ**ï¼š
> è‡ªåŠ¨åŒ–ç³»ç»Ÿä¸­ï¼Œ**éšå¼ä¼˜å…ˆçº§**ï¼ˆæç¤ºè¯æš—ç¤ºã€Harvest æœºåˆ¶ï¼‰ä¼š"ç»‘æ¶"æ˜¾å¼é€»è¾‘ã€‚å¿…é¡»ç”¨**å¼ºåˆ¶çº¦æŸ**ï¼ˆæœç´¢å®Œæˆæ£€æŸ¥ï¼‰æ¥ä¿è¯å¹³è¡¡ã€‚

ç°åœ¨è¿è¡Œç¨‹åºï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š
- âœ… Bilibili è¢«æ­£å¸¸è°ƒç”¨
- âœ… ç­›é€‰å™¨æœ‰æ•°æ®é€šè¿‡
- âœ… æœ€ç»ˆç”Ÿæˆé€‰é¢˜

æµ‹è¯•æ„‰å¿«ï¼ğŸš€
