# 系统完整流程图

**更新日期**: 2025-11-27
**包含功能**: 双引擎收集 + 人工选题 + 深度分析

---

## 🗺️ 完整流程总览

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户输入                                   │
│  - 目标领域: ["AI技术", "内容创作"]                              │
│  - 优先主题: ["AI生图"]                                          │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  1️⃣ Keyword Designer (关键词设计器)                              │
│  ─────────────────────────────────────────────────────────────  │
│  功能: 生成优化的搜索关键词                                       │
│  输出:                                                           │
│    - discovery_queries: ["top AI art creators 2025"]           │
│    - content_queries: ["AI image generation tutorial"]         │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  2️⃣ Planner (任务规划器) - ReAct 循环                            │
│  ─────────────────────────────────────────────────────────────  │
│  阶段 A: Web 搜索发现博主                                        │
│    - 执行 discovery_queries                                     │
│    - 收集推荐文章                                                │
│    ↓                                                            │
│  ┌─────────────────────────────────────┐                       │
│  │ 3️⃣ Influencer Extractor (博主提取)  │                       │
│  │ ─────────────────────────────────── │                       │
│  │ - 从文章提取博主名称                 │                       │
│  │ - 分层置信度 (high/medium/low)      │                       │
│  │ - 输出: discovered_influencers      │                       │
│  └─────────────────────────────────────┘                       │
│    ↓                                                            │
│  阶段 B: 动态生成博主任务                                        │
│    - 为每个博主生成搜索任务                                      │
│    ↓                                                            │
│  阶段 C: 生成关键词搜索任务                                      │
│    - content_queries → 搜索任务                                 │
│    ↓                                                            │
│  阶段 D: 执行器执行任务                                          │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  4️⃣ Executor (执行器)                                            │
│  ─────────────────────────────────────────────────────────────  │
│  引擎 1: 博主搜索 (高质量)                                       │
│    - YouTube API: 搜索博主视频                                   │
│    - Bilibili API: 搜索 UP主 视频                               │
│    - 优先级: 70 (高)                                            │
│                                                                 │
│  引擎 2: 关键词搜索 (广度覆盖)                                   │
│    - YouTube 关键词搜索                                          │
│    - Bilibili 关键词搜索                                         │
│    - 优先级: 50 (中)                                            │
│                                                                 │
│  质量门 (Quality Gate):                                         │
│    - 自动检测低质量结果                                          │
│    - 触发重试 (调整参数或跳过)                                   │
│                                                                 │
│  输出: candidates (原始内容列表)                                 │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  5️⃣ Filter (混合筛选器)                                          │
│  ─────────────────────────────────────────────────────────────  │
│  多维度评分:                                                     │
│    - 播放量/互动率                                               │
│    - 发布时间 (新鲜度)                                           │
│    - 作者影响力                                                  │
│    - 标题相关性                                                  │
│                                                                 │
│  输出: filtered_candidates (高质量内容)                          │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  6️⃣ Architect (选题架构师)                                       │
│  ─────────────────────────────────────────────────────────────  │
│  聚类分析:                                                       │
│    - 提取核心主题                                                │
│    - 识别独特角度                                                │
│    - 生成选题简报 (TopicBrief)                                   │
│                                                                 │
│  输出示例:                                                       │
│    [                                                            │
│      {                                                          │
│        "title": "AI绘图技术革命",                                │
│        "core_angle": "Stable Diffusion vs MidJourney",         │
│        "rationale": "高热度，技术深度足够",                       │
│        "reference_data": [15条高质量内容]                        │
│      },                                                         │
│      ...                                                        │
│    ]                                                            │
└─────────────────────────────────────────────────────────────────┘
                            ↓
╔═════════════════════════════════════════════════════════════════╗
║  🎯 Topic Selector (人工选题审核) - 新增节点                     ║
╚═════════════════════════════════════════════════════════════════╝
                            ↓
        ┌───────────────────────────────────┐
        │  配置检查                          │
        │  enable_topic_selection?          │
        └───────────────────────────────────┘
                ↓                    ↓
        ┌───────────┐          ┌────────────┐
        │ true      │          │ false      │
        │ (交互模式) │          │ (自动模式)  │
        └───────────┘          └────────────┘
                ↓                    ↓
┌───────────────────────────┐  ┌────────────────────┐
│  A. 交互模式流程          │  │  B. 自动模式流程    │
│  ───────────────────────  │  │  ───────────────── │
│                           │  │                    │
│  📋 展示选题列表:         │  │  ⚡ 自动选择        │
│  ┌─────────────────────┐ │  │  Top N 个选题      │
│  │ 【选题 1】          │ │  │  (默认 N=3)        │
│  │ 标题: AI绘图技术革命 │ │  │                    │
│  │ 切入点: SD vs MJ    │ │  │  ✅ 输出选定选题   │
│  │ 理由: 高热度       │ │  │                    │
│  │ 数据: 15条         │ │  └────────────────────┘
│  └─────────────────────┘ │
│  【选题 2】...           │
│  【选题 3】...           │
│                          │
│  💡 用户选择:            │
│  ┌─────────────────────┐│
│  │ 输入: 1,3           ││
│  │ 或: all (全选)      ││
│  │ 或: none (跳过)     ││
│  └─────────────────────┘│
│         ↓                │
│  ✓ 已选择: 选题 1, 3    │
│                          │
│  📝 添加自定义?          │
│  ┌─────────────────────┐│
│  │ 输入: y             ││
│  │ 标题: AI音乐生成    ││
│  │ 切入点: 商业应用    ││
│  │ 理由: 新兴热点      ││
│  └─────────────────────┘│
│         ↓                │
│  ✅ 最终选定:            │
│    - 选题 1 (AI)        │
│    - 选题 3 (AI)        │
│    - AI音乐生成 (自定义)│
│                          │
└───────────────────────────┘
                ↓
        ┌───────────────┐
        │  合并输出     │
        └───────────────┘
                ↓
┌─────────────────────────────────────────────────────────────────┐
│  输出: proposals (最终选定的选题列表)                             │
│  - 来源: AI 筛选 + 用户自定义                                    │
│  - 数量: 用户决定 (1-N 个)                                       │
└─────────────────────────────────────────────────────────────────┘
                            ↓
╔═════════════════════════════════════════════════════════════════╗
║  🚀 Analyst Agent (深度分析智能体) - 三级火箭                    ║
╚═════════════════════════════════════════════════════════════════╝
                            ↓
        ┌───────────────────────────────────┐
        │  对每个选定的 TopicBrief 执行:     │
        └───────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  🚀 Level 1: Adaptive Scout (动态侦察规划)                       │
│  ─────────────────────────────────────────────────────────────  │
│  模型: Fast Model (creative)                                    │
│                                                                 │
│  选题分类:                                                       │
│    - "AI绘图技术" → tech_ai                                     │
│                                                                 │
│  搜索策略:                                                       │
│    1. arxiv_search: "Stable Diffusion 2024"                    │
│    2. web_search: "SD vs MidJourney comparison site:github.com"│
│    3. web_search: "AI image generation tutorial"              │
│                                                                 │
│  输出: ResearchPlan                                             │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  🚀 Level 2: Excavator (智能萃取)                                │
│  ─────────────────────────────────────────────────────────────  │
│  模型: Fast Model (creative)                                    │
│                                                                 │
│  2.1 执行搜索:                                                   │
│    - Arxiv 搜索 → 3篇论文                                        │
│    - Web 搜索 → 6篇文章 (含 raw_content)                        │
│                                                                 │
│  2.2 智能萃取 (每个来源):                                        │
│    ┌─────────────────────────────────┐                         │
│    │ 输入: 20k tokens 长文本         │                         │
│    │ 提示: 提取事实、原文引用、冲突点│                         │
│    │ 输出: KeyInsight 卡片           │                         │
│    │   - source: "Arxiv 论文"       │                         │
│    │   - quote: "原文数据..."       │                         │
│    │   - insight: "价值解读..."     │                         │
│    │   - conflict: "与主流冲突..."  │                         │
│    └─────────────────────────────────┘                         │
│                                                                 │
│  输出: List[KeyInsight] (5-10个高信噪比卡片)                     │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  🚀 Level 3: Philosopher (认知重构)                              │
│  ─────────────────────────────────────────────────────────────  │
│  模型: Reasoning Model (reasoning)                              │
│                                                                 │
│  思维框架:                                                       │
│    1️⃣ First Principles (5-Why 追问)                             │
│       Q: 为什么扩散模型取代 GAN?                                 │
│       → 训练稳定性                                               │
│       Q: 为什么更稳定?                                           │
│       → 单向优化 vs 对抗博弈                                     │
│       ...                                                       │
│       → Root Cause: 熵增可逆性                                  │
│                                                                 │
│    2️⃣ Dialectic (辩证法)                                        │
│       主流观点: AI 绘图替代插画师                                │
│       反面思考: AI 降低门槛 → 扩容创作者市场                     │
│       冲突点: "替代" vs "扩容"                                   │
│                                                                 │
│    3️⃣ Mental Models (思维模型匹配)                              │
│       - 熵增定律 (扩散过程)                                      │
│       - 网络效应 (创作者社区)                                    │
│       - 损失厌恶 (插画师恐惧)                                    │
│                                                                 │
│  输出: DeepAnalysisReport                                       │
│    ├─ 事实层: hard_evidence (带引用)                            │
│    ├─ 逻辑层: root_cause, theoretical_model                     │
│    ├─ 洞察层: mainstream_view, contrarian_view                  │
│    └─ 叙事层: emotional_hook, content_strategy                  │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│  最终输出: analysis_reports                                      │
│  ─────────────────────────────────────────────────────────────  │
│  [                                                              │
│    {                                                            │
│      "topic_title": "AI绘图技术革命",                            │
│      "root_cause": "扩散模型的本质是可逆熵增...",                │
│      "contrarian_view": "AI 不是替代而是扩容市场...",            │
│      "emotional_hook": "恐惧(失业) + 好奇(创作)",                │
│      "confidence_score": 0.85,                                 │
│      "sources_used": [KeyInsight1, KeyInsight2, ...]           │
│    },                                                           │
│    ...                                                          │
│  ]                                                              │
└─────────────────────────────────────────────────────────────────┘
                            ↓
                        🎉 完成
```

---

## 🎯 关键节点详解

### 节点 1-2: 双引擎准备 (Keyword Designer + Planner)

**目标**: 发现高质量博主和内容

**策略**:
- Engine 1: 找博主 → 顺藤摸瓜
- Engine 2: 找内容 → 广度覆盖

**关键词优化** (基于 2025 研究):
- YouTube: 3-5词甜蜜点，避免 "short"
- Bilibili: 使用社区黑话，避免月份数字

---

### 节点 3: 博主提取 (Influencer Extractor)

**创新点**: 激进提取 + 置信度分层

**策略**:
- 有 @handle/UID → high confidence
- 只有名字 → medium confidence
- 模糊提及 → low confidence

**理念**: 宁可多提取（over-extract），让质量门过滤

---

### 节点 4-5: 执行与筛选 (Executor + Filter)

**质量门机制**:
```
搜索结果 → 质量检查 → 自适应反馈
                ↓
        [相关] → 继续
        [不相关] → 调整参数重试
        [失败3次] → 跳过任务
```

**筛选维度**:
- 数据指标: 播放量、互动率
- 时间维度: 发布日期
- 创作者维度: 粉丝数、影响力

---

### 节点 6: 选题生成 (Architect)

**聚类逻辑**:
```
58条内容 → TF-IDF 提取关键词
         → K-Means 聚类
         → 生成 3-5 个主题簇
         → 每个簇提炼为 TopicBrief
```

**输出质量**:
- 标题: 吸引力 + 清晰度
- 切入点: 独特角度
- 理由: 数据支撑

---

### 节点 7: 人工选题 (Topic Selector) ⭐ 新增

**核心价值**: 人机协作

**用户掌控**:
- ✅ 选择感兴趣的选题
- ✅ 过滤不相关的建议
- ✅ 添加 AI 未发现的选题

**灵活配置**:
- 交互模式: 等待用户决策
- 自动模式: 批处理运行

---

### 节点 8: 深度分析 (Analyst) ⭐ 新增

**三级火箭**:
1. **Scout**: 智能 → 根据选题类型规划搜索
2. **Excavator**: 高效 → 长文本批量萃取
3. **Philosopher**: 深度 → 第一性原理推导

**输出特色**:
- 反直觉洞察 (Contrarian View)
- 底层逻辑 (Root Cause)
- 内容策略 (Content Strategy)

---

## 📊 数据流示例

### 示例: "AI生图" 主题

```
用户输入: "AI生图"
    ↓
Keyword Designer:
    discovery_queries = ["best AI art creators 2025 YouTube"]
    content_queries = ["AI image generation Stable Diffusion tutorial"]
    ↓
Planner → Web Search:
    找到文章: "Top 10 AI Art Channels in 2025"
    ↓
Influencer Extractor:
    提取: Stable Diffusion Art, Two Minute Papers, Corridor Crew
    ↓
Planner → 生成博主任务:
    Task 1: youtube_search("Stable Diffusion Art AI生图")
    Task 2: youtube_search("Two Minute Papers AI生图")
    Task 3: bilibili_search("AI生图 教程")
    ↓
Executor:
    收集 58 条视频
    ↓
Filter:
    筛选出 32 条高质量
    ↓
Architect:
    生成 3 个选题:
      1. AI绘图技术革命 (SD vs MJ)
      2. AI 艺术伦理问题
      3. Prompt Engineering 实战
    ↓
Topic Selector (用户交互):
    展示 3 个选题
    用户选择: 1, 3
    用户添加: "AI 音乐生成"
    ↓
    最终选定:
      1. AI绘图技术革命
      2. Prompt Engineering 实战
      3. AI 音乐生成 (自定义)
    ↓
Analyst (选题 1):
    Level 1 Scout: tech_ai → 搜索 Arxiv + GitHub
    Level 2 Excavator: 提取 8 个 KeyInsight
    Level 3 Philosopher:
      root_cause = "扩散模型可逆熵增..."
      contrarian_view = "不是替代而是扩容..."
      confidence = 0.85
    ↓
Analyst (选题 2):
    ...
    ↓
Analyst (选题 3):
    Level 1 Scout: tech_ai (音乐生成)
    Level 2: 搜索 AI music generation 论文
    Level 3: 深度分析
    ↓
输出 3 份深度分析报告
```

---

## 🔧 技术栈总览

| 层级 | 组件 | 技术 |
|------|------|------|
| **编排** | LangGraph | StateGraph, Conditional Edges |
| **LLM** | OpenRouter | Kimi K2, DeepSeek V3/R1 |
| **搜索** | Tavily, Arxiv | Web 搜索 + 学术搜索 |
| **平台 API** | YouTube, Bilibili | 内容数据收集 |
| **数据结构** | Pydantic | 类型安全 + 自动验证 |
| **配置** | YAML | 灵活配置驱动 |
| **交互** | Colorama | 彩色终端输出 |

---

## ⚙️ 配置总览

### `config/settings.yaml`

```yaml
# 目标领域
target_domains:
  - "AI News"
  - "Python Tutorials"

# 白名单 KOL (可选)
whitelist_kols:
  youtube: []
  bilibili: []

# 筛选阈值
thresholds:
  low_fan_limit: 50000
  min_interaction: 5000
  viral_coefficient: 0.1

# 执行参数
execution:
  max_duration_minutes: 5

# 🎯 人工交互 (新增)
interaction:
  enable_topic_selection: true   # 启用人工选题
  auto_select_top_n: 3           # 自动模式选择数量
  allow_custom_topics: true      # 允许自定义
```

### `config/models.yaml`

```yaml
# 创意任务 (规划、萃取)
creative:
  model_id: "moonshotai/kimi-k2-0905"

# 推理任务 (深度分析)
reasoning:
  model_id: "moonshotai/kimi-k2-0905"
```

---

## 💡 使用场景对比

| 场景 | 配置 | 流程 |
|------|------|------|
| **日常创作** | 交互模式开启 | 收集 → 生成选题 → 人工选择 → 深度分析 |
| **批量生产** | 交互模式关闭 | 收集 → 生成选题 → 自动选择 → 深度分析 |
| **纯手动模式** | 交互模式 + 跳过AI | 收集 → (跳过选择) → 手动添加 → 深度分析 |

---

## 🎉 系统特色

### 1. 智能化
- ✅ 自适应关键词设计
- ✅ 动态博主发现
- ✅ 自动质量检查与重试
- ✅ 智能选题分类与搜索

### 2. 人机协作
- ✅ AI 数据驱动 + 人类创意
- ✅ 可选交互 vs 全自动
- ✅ 灵活配置切换

### 3. 深度分析
- ✅ 三级火箭架构
- ✅ 第一性原理推导
- ✅ 反直觉洞察生成

### 4. 鲁棒性
- ✅ 多层降级策略
- ✅ 全面错误处理
- ✅ 成本可控

---

**系统版本**: v2.0 (含人工选题 + 深度分析)
**更新时间**: 2025-11-27
